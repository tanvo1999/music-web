function lerp(e,t,a){return e+a*(t-e)}function prettyTime(e){e=e||0;var t=e%60|0,a=e/60%60|0,n=e/3600|0;return n?n+":"+("0"+a).substr(-2)+":"+("0"+t).substr(-2):a+":"+("0"+t).substr(-2)}function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function clamp(e,t,a){return Math.max(Math.min(e,a),t)}function ExpressionProperty(e){e||(e=0),e instanceof ExpressionProperty&&(e=e.expr);var t=e.toString(),a=new Function(exprArgs.join(","),"return ("+t+")"),n=+t;Object.defineProperty(this,"value",{get:function(){if(!Number.isNaN(n))return n;try{return a(null,null,null,Math.random,smoothrand,Math.max,Math.min,clamp,Math.floor,Math.ceil,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval,frameProps.csize,frameProps.imgw,frameProps.imgh,frameProps.imgr,currentSongTitle,frameProps.prettytime,frameProps.prettyduration)}catch(e){return 0}}}),Object.defineProperty(this,"expr",{get:function(){return t},set:function(e){""===e&&(e="0"),t=e,n=+e,Number.isNaN(n)&&(a=new Function(exprArgs.join(","),"return ("+t+")"))}})}function AdvancedSettings(e){this.set(e)}function AnalyserSection(e){e=e||{},this.dataCount=new ExpressionProperty(isNullOrUndef(e.dataCount)?128:e.dataCount),this.lineWidth=new ExpressionProperty(isNullOrUndef(e.lineWidth)?1:e.lineWidth),this.lineCap=isNullOrUndef(e.lineCap)?lineCapMode.BUTT:lineCapMode[e.lineCap],this.startX=new ExpressionProperty(isNullOrUndef(e.startX)?-1:e.startX),this.endX=new ExpressionProperty(isNullOrUndef(e.endX)?1:e.endX),this.yPos=new ExpressionProperty(isNullOrUndef(e.yPos)?0:e.yPos),this.exponent=new ExpressionProperty(isNullOrUndef(e.exponent)?1:e.exponent),this.height=new ExpressionProperty(isNullOrUndef(e.height)?.5:e.height),this.mode=isNullOrUndef(e.mode)?drawMode.LINES:drawMode[e.mode],this.polar=new ExpressionProperty(isNullOrUndef(e.polar)?0:e.polar),this.clampShapeToZero=!!isNullOrUndef(e.clampShapeToZero)||e.clampShapeToZero,this.closeShape=!!isNullOrUndef(e.closeShape)||e.closeShape,this.drawLast=!!isNullOrUndef(e.drawLast)||e.drawLast,this.quadratic=!!isNullOrUndef(e.quadratic)||e.quadratic}function FreqSection(e){AnalyserSection.call(this,e),e=e||{},this.minDecibels=new ExpressionProperty(isNullOrUndef(e.minDecibels)?-100:e.minDecibels),this.maxDecibels=new ExpressionProperty(isNullOrUndef(e.maxDecibels)?-20:e.maxDecibels),this.minHeight=new ExpressionProperty(isNullOrUndef(e.minHeight)?.01:e.minHeight),this.freqStart=new ExpressionProperty(isNullOrUndef(e.freqStart)?0:e.freqStart),this.freqEnd=new ExpressionProperty(isNullOrUndef(e.freqEnd)?.03:e.freqEnd),this.smartFill=!isNullOrUndef(e.smartFill)&&e.smartFill}function TimeDomSection(e){AnalyserSection.call(this,e),e=e||{},this.lineJoin=isNullOrUndef(e.lineJoin)?lineJoinMode.ROUND:lineJoinMode[e.lineJoin]}function ImageSection(e){e=e||{},this.imageURL=isNullOrUndef(e.imageURL)?"":e.imageURL,this.imageBorderRadius=new ExpressionProperty(isNullOrUndef(e.imageBorderRadius)?0:e.imageBorderRadius),this.opaque=!isNullOrUndef(e.opaque)&&e.opaque,this.borderSize=new ExpressionProperty(isNullOrUndef(e.borderSize)?0:e.borderSize),this.borderColor=isNullOrUndef(e.borderColor)?"#ffffff":e.borderColor,this.borderVisible=!isNullOrUndef(e.borderVisible)&&e.borderVisible;var t=this;this.image=new Image;var a=!1;this.image.onload=function(){a=!0},Object.defineProperty(this,"imageReady",{get:function(){return a}}),this.watch("imageURL",function(e,n,i){return a=!1,t.image.src=i,i}),this.image.src=this.imageURL}function TextSection(e){e=e||{},this.text=new ExpressionProperty(isNullOrUndef(e.text)?'"Type your text here"':e.text),this.fontStyle=isNullOrUndef(e.fontStyle)?"normal":e.fontStyle,this.fontSize=new ExpressionProperty(isNullOrUndef(e.fontSize)?.2:e.fontSize),this.fontFamily=isNullOrUndef(e.fontFamily)?"sans-serif":e.fontFamily,this.textAlign=isNullOrUndef(e.textAlign)?textAlignMode.CENTER:textAlignMode[e.textAlign],this.textBaseline=isNullOrUndef(e.textBaseline)?textBaselineMode.ALPHABETIC:textBaselineMode[e.textBaseline]}function Section(e){e=e||{},this.name=isNullOrUndef(e.name)?"A section":e.name,this.type=isNullOrUndef(e.type)?sectionType.FREQ:sectionType[e.type],this.visible=!!isNullOrUndef(e.visible)||e.visible,this.opacity=new ExpressionProperty(isNullOrUndef(e.opacity)?1:e.opacity),this.posX=new ExpressionProperty(isNullOrUndef(e.posX)?0:e.posX),this.posY=new ExpressionProperty(isNullOrUndef(e.posY)?0:e.posY),this.rotation=new ExpressionProperty(isNullOrUndef(e.rotation)?0:e.rotation),this.scaleX=new ExpressionProperty(isNullOrUndef(e.scaleX)?1:e.scaleX),this.scaleY=new ExpressionProperty(isNullOrUndef(e.scaleY)?1:e.scaleY),this.color=isNullOrUndef(e.color)?"#ffffff":e.color,this.glowness=new ExpressionProperty(isNullOrUndef(e.glowness)?0:e.glowness),this.target=null,this.type===sectionType.FREQ?this.target=new FreqSection(e.target?e.target:e):this.type===sectionType.TIME_DOM?this.target=new TimeDomSection(e.target?e.target:e):this.type===sectionType.IMAGE?this.target=new ImageSection(e.target?e.target:e):this.type===sectionType.TEXT&&(this.target=new TextSection(e.target?e.target:e));var t=this;this.watch("type",function(e,a,n){return a instanceof EnumerationValue&&a.ownerEnum===sectionType&&n!==a?(n===sectionType.FREQ?t.target=new FreqSection(t.target):n===sectionType.TIME_DOM?t.target=new TimeDomSection(t.target):n===sectionType.IMAGE?t.target=new ImageSection(t.target):n===sectionType.TEXT&&(t.target=new TextSection(t.target)),refreshControls(refreshables.TABS_BIT),n):a})}function Settings(e){this.set(e)}function loadPreset(e){if(isNullOrUndef(e)){var t=[];for(var a in settingsPresets)t.push(a);e=t[Math.floor(Math.random()*t.length)]}settings.set(settingsPresets[e]),refreshControls()}function loadFilePreset(e,t){if(e){var a=e.name.substr(0,e.name.lastIndexOf(".")),n=new FileReader;n.onload=function(e){for(var n=new Settings(JSON.parse(e.target.result)),i=a,s=0;void 0!==settingsPresets[i];)i=a+" ("+s+")",s++;settingsPresets[i]=n,t&&loadPreset(i)},n.readAsText(e)}}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var a=this[e],n=a,i=function(){return n},s=function(i){return a=n,n=t.call(this,e,a,i)};delete this[e]&&Object.defineProperty(this,e,{get:i,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}});var smoothrand=function(){var e=[],t=0,a=0;return function(n){return n=n<0?-n:n,t=0|n,a=n+1|0,isNullOrUndef(e[t])&&(e[t]=Math.random()),isNullOrUndef(e[a])&&(e[a]=Math.random()),lerp(e[t],e[a],Math.cos((n-t)*-1*Math.PI)*-.5+.5)}}();CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,n,i){return i=Math.max(i,0),0===i?(this.beginPath(),void this.rect(e,t,a,n)):(a<2*i&&(i=a/2),n<2*i&&(i=n/2),this.beginPath(),this.moveTo(e+i,t),this.arcTo(e+a,t,e+a,t+n,i),this.arcTo(e+a,t+n,e,t+n,i),this.arcTo(e,t+n,e,t,i),this.arcTo(e,t,e+a,t,i),void this.closePath())},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,MediaStream=window.MediaStream||window.webkitMediaStream,MediaRecorder=window.MediaRecorder||window.webkitMediaRecorder,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),sectionType=new Enumeration(["FREQ","TIME_DOM","IMAGE","TEXT"]),lineCapMode=new Enumeration(["BUTT","ROUND","SQUARE"]),lineJoinMode=new Enumeration(["MITER","ROUND","BEVEL"]),textAlignMode=new Enumeration(["LEFT","CENTER","RIGHT"]),textBaselineMode=new Enumeration(["TOP","HANGING","MIDDLE","ALPHABETIC","IDEOGRAPHIC","BOTTOM"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["alert","window","navigator","rand","smoothrand","max","min","clamp","floor","ceil","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval","csize","imgw","imgh","imgr","songtitle","prettytime","prettyduration"],frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER,csize:0,imgw:0,imgh:0,imgr:0,time:0,duration:0,prettytime:"0:00",prettyduration:"0:00"},currentSongTitle="Silence";ExpressionProperty.prototype.toJSON=function(){return this.expr},AdvancedSettings.prototype.set=function(e){e=e||{},this.enableLowpass=!isNullOrUndef(e.enableLowpass)&&e.enableLowpass,this.enableHighpass=!isNullOrUndef(e.enableHighpass)&&e.enableHighpass,this.lowpassFreq=isNullOrUndef(e.lowpassFreq)?120:+e.lowpassFreq,this.highpassFreq=isNullOrUndef(e.highpassFreq)?480:+e.highpassFreq,this.lowpassSmooth=isNullOrUndef(e.lowpassSmooth)?.65:+e.lowpassSmooth,this.highpassSmooth=isNullOrUndef(e.highpassSmooth)?.65:+e.highpassSmooth},Settings.prototype={addSection:function(e){return this.sections.push(new Section(e)),this},set:function(e){if(e=e||{},this.smoothingTimeConstant=new ExpressionProperty(isNullOrUndef(e.smoothingTimeConstant)?.65:e.smoothingTimeConstant),this.sections=[],Array.isArray(e.sections))for(var t=0;t<e.sections.length;t++)this.addSection(e.sections[t]);this.globalScale=new ExpressionProperty(isNullOrUndef(e.globalScale)?1:e.globalScale),this.globalOffsetX=new ExpressionProperty(isNullOrUndef(e.globalOffsetX)?0:e.globalOffsetX),this.globalOffsetY=new ExpressionProperty(isNullOrUndef(e.globalOffsetY)?0:e.globalOffsetY),this.globalRotation=new ExpressionProperty(isNullOrUndef(e.globalRotation)?0:e.globalRotation),this.backgroundColor=isNullOrUndef(e.backgroundColor)?"#3b3b3b":e.backgroundColor,this.advanced?this.advanced.set(e.advanced):this.advanced=new AdvancedSettings(e.advanced)}};var settingsPresets={Default:(new Settings).addSection(),"Time domain default":new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","type":"TIME_DOM","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"256","lineWidth":"1","lineCap":"BUTT","polar":"0","lineJoin":"ROUND","startX":"-1","endX":"1","yPos":"0","exponent":"1","height":"0.5","mode":"OUTLINE","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true}}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":false,"enableHighpass":false,"lowpassFreq":120,"highpassFreq":480}}')),"The Dub Rebellion":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Background","type":"IMAGE","visible":true,"opacity":"1","posX":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","posY":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","rotation":"0","scaleX":"(imgr * 2.4) / max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","scaleY":"2.4 / max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","color":"#ffffff","glowness":"0","target":{"imageURL":"me163.jpg","imageBorderRadius":"0","image":{}}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#fbfe5c","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.4","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#fbfe5c","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"2.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.4","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#fe89d8","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.3","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#fe89d8","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"2.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.3","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#c6def7","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.2","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#c6def7","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"2.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.2","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#505986","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.1","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#505986","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"2.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.1","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"-0.005","freqEnd":"0.03","smartFill":true}},{"name":"A section","type":"IMAGE","visible":true,"opacity":"1","posX":"0.006","posY":"0.018","rotation":"0","scaleX":"1.15","scaleY":"1.15","color":"#ffffff","glowness":"0","target":{"imageURL":"tdr.png","imageBorderRadius":"0","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalOffsetY":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":100,"highpassFreq":480,"lowpassSmooth":0.8,"highpassSmooth":0.8}}')),Monstercat:new Settings(JSON.parse('{"smoothingTimeConstant":"0.8","sections":[{"name":"Background","type":"IMAGE","visible":true,"opacity":"1","posX":"0.02 * (smoothrand(time) * 2 - 1)","posY":"0.02 * (smoothrand(time + duration) * 2 - 1)","rotation":"0","scaleX":"imgr * 2.4","scaleY":"2.4","color":"#ffffff","glowness":"0","target":{"imageURL":"me163.jpg","imageBorderRadius":"0","image":{}}},{"name":"Frequency bars","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"64","lineWidth":"2.5","lineCap":"BUTT","startX":"-1","endX":"1","yPos":"0","exponent":"6","height":"0.4","mode":"LINES","polar":"0","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-60","maxDecibels":"-20","minHeight":"0.01","freqStart":"0","freqEnd":"0.02","smartFill":false}},{"name":"Title 1","type":"TEXT","visible":true,"opacity":"1","posX":"-0.6","posY":"-0.06","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"text":"\\"MONSTERCAT PODCAST\\"","fontStyle":"bold","fontSize":"0.12","fontFamily":"Verdana","textAlign":"LEFT","textBaseline":"TOP"}},{"name":"Title 2","type":"TEXT","visible":true,"opacity":"1","posX":"-0.6","posY":"-0.19","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"text":"\\"EP. 122\\"","fontStyle":"bold","fontSize":"0.12","fontFamily":"Verdana","textAlign":"LEFT","textBaseline":"TOP"}},{"name":"Subtitle","type":"TEXT","visible":true,"opacity":"1","posX":"-0.6","posY":"-0.33","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"text":"\\"Direct Takeover\\"","fontStyle":"normal","fontSize":"0.12","fontFamily":"Verdana","textAlign":"LEFT","textBaseline":"TOP"}},{"name":"Artwork","type":"IMAGE","visible":true,"opacity":"1","posX":"-0.82","posY":"-0.25","rotation":"0","scaleX":"0.4","scaleY":"0.4","color":"#ffffff","glowness":"0","target":{"imageURL":"mc.png","imageBorderRadius":"0","image":{}}}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":false,"enableHighpass":false,"lowpassFreq":120,"highpassFreq":480,"lowpassSmooth":0.65,"highpassSmooth":0.65}}')),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Background","type":"IMAGE","visible":true,"opacity":"1","posX":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","posY":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","rotation":"0","scaleX":"(imgr * 2.4) / max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","scaleY":"2.4 / max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","color":"#ffffff","glowness":"0","target":{"imageURL":"me163.jpg","imageBorderRadius":"0","image":{}}},{"name":"Bass top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"-0.55","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.04","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0","freqEnd":"0.014","smartFill":true}},{"name":"Bass bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.04","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0","freqEnd":"0.014","smartFill":true}},{"name":"High top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"1.45","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.03","smartFill":true}},{"name":"High bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.03","smartFill":true}},{"name":"Image","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.41","scaleY":"0.41","color":"#ffffff","glowness":"0","target":{"imageURL":"dsg.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalOffsetY":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480,"lowpassSmooth":0.8,"highpassSmooth":0.8}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Background","type":"IMAGE","visible":true,"opacity":"1","posX":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","posY":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","rotation":"0","scaleX":"(imgr * 2.4) / max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","scaleY":"2.4 / max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","color":"#ffffff","glowness":"0","target":{"imageURL":"me163.jpg","imageBorderRadius":"0","image":{}}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.8","scaleY":"0.8","color":"#ffffff","glowness":"0","target":{"imageURL":"dtb.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalOffsetY":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":100,"highpassFreq":480,"lowpassSmooth":0.8,"highpassSmooth":0.8}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","dataCount":"256","freqStart":"0","freqEnd":"0.1","lineWidth":"0.5","startX":"-1","endX":"1","yPos":"0.2","color":"#ff0000","exponent":"3","height":"-1","minHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,activeSection=null,refreshControls=function(){var e=null,t=null,a=null,n=null,i=null,s=null,o=null,r=null,l=null,c=null,d=null,p=!1,u=[],m=function(){for(var e=-1,t=0;t<a.children.length;t++)a.children[t].classList.contains("activated")&&(e=t);for(;0!==i.children.length;)i.removeChild(i.children[0]);for(;0!==a.children.length&&a.children[0]!==n;)a.removeChild(a.children[0]);for(var t=0;t<settings.sections.length;t++)w(t);if(e!==-1){for(var t=0;t<u[e].length;t++)i.appendChild(u[e][t]);a.children.length>1?(a.children[Math.min(e,a.children.length-2)].classList.add("activated"),activeSection=settings.sections[Math.min(e,a.children.length-2)]):activeSection=null}else activeSection=null},f=function(e,t){var a=e[t];if(isNullOrUndef(a)&&(a=""),"object"==typeof a&&!a.hasOwnProperty("expr")||"function"==typeof a)return null;var n=document.createElement("li"),i=document.createElement("span"),s=document.createElement("input");if(n.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t,"boolean"==typeof a)s.type="checkbox",s.checked=a;else if(t.toLowerCase().endsWith("color"))s.type="color",s.value=a.toString();else{s.type="text",s.placeholder=a instanceof ExpressionProperty?"expression":typeof a;var o=a.toString();a instanceof ExpressionProperty?s.value=a.expr:o.startsWith("data:")?s.value="DataURL":s.value=a.toString()}if(s.addEventListener("change",function(){if("number"==typeof e[t]){if(""===this.value)return;e[t]=this.value}else"boolean"==typeof e[t]?e[t]=this.checked:e[t].hasOwnProperty("expr")?e[t].expr=this.value:e[t]=this.value}),n.appendChild(i),n.appendChild(s),"boolean"==typeof a){var r=document.createElement("span");r.classList.add("ctrlCheckbox","fa"),r.addEventListener("click",function(a){e[t]=s.checked=!s.checked}),n.appendChild(r)}return n},h=function(e,t,a){var n=(e[t],document.createElement("li")),i=document.createElement("span"),s=document.createElement("select");n.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t;for(var o in a){var r=document.createElement("option");r.value=o,r.innerHTML=o,s.appendChild(r),e[t]===a[o]&&(s.value=o)}return s.addEventListener("change",function(){var n=a[this.value];e[t]=n}),n.appendChild(i),n.appendChild(s),n},g=function(e,t){var n=e[t],i=document.createElement("li"),s=document.createElement("input"),o=document.createElement("ul");i.classList.add("settingsMajorCtrl"),s.classList.add("ctrlMajorInput"),o.classList.add("ctrlOptions"),s.type="text",s.placeholder=t,s.value=n.toString();var r=document.createElement("li"),l=document.createElement("li"),c=document.createElement("li");r.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),l.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var d=document.createElement("i"),p=document.createElement("i");return d.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),p.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),c.classList.add("ctrlOptMoves"),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(p),d.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t>=settings.sections.length-1)){var n=settings.sections[t];settings.sections[t]=settings.sections[t+1],settings.sections[t+1]=n,m(),a.children[t+1].click()}}),p.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t<=0)){var n=settings.sections[t];settings.sections[t]=settings.sections[t-1],settings.sections[t-1]=n,m(),a.children[t-1].click()}}),r.addEventListener("click",function(){var t=new Section(e);settings.sections.push(t),w(settings.sections.length-1)}),l.addEventListener("click",function(){var t=settings.sections.indexOf(e);settings.sections.splice(t,1),b(t)}),o.appendChild(c),o.appendChild(r),o.appendChild(l),s.addEventListener("change",function(){e[t]=this.value,a.children[settings.sections.indexOf(e)].title=e[t]}),i.appendChild(s),i.appendChild(o),i},v=function(){function e(e){for(var a in e){var n=null;n=e[a]instanceof EnumerationValue?h(e,a,e[a].ownerEnum):"name"===a?g(e,a):f(e,a),n&&t.push(n)}}var t=null;return function(a){return t=[],e(a),e(a.target),t}}(),y=function(){if(this!==n&&!this.classList.contains("activated")){for(var e=-1,t=0;t<settings.sections.length;t++)a.children[t]!==this?a.children[t].classList.contains("activated")&&a.children[t].classList.remove("activated"):e=t;for(this.classList.add("activated");0!==i.children.length;)i.removeChild(i.children[0]);for(var t=0;t<u[e].length;t++)i.appendChild(u[e][t]);activeSection=settings.sections[e]}},w=function(e){var t=document.createElement("li");t.innerHTML=e.toString(),t.title=settings.sections[e].name,t.classList.add("sectionTab"),t.addEventListener("click",y),a.insertBefore(t,n),u[e]=v(settings.sections[e])},b=function(e){var t=a.children[e];t&&(t.removeEventListener("click",y),a.removeChild(t),m())},E=function(){for(;0!==e.children.length;)e.removeChild(e.children[0]);for(var a in settings){var n=f(settings,a);n&&e.appendChild(n)}for(;0!==t.children.length;)t.removeChild(t.children[0]);for(var a in settings.advanced){var n=f(settings.advanced,a);n&&t.appendChild(n)}},S=function(){for(;0!==s.children.length;)s.removeChild(s.children[0]);for(var e in settingsPresets){var t=document.createElement("li");t.innerHTML=e.toString(),t.addEventListener("click",function(){
var t=e;return function(){loadPreset(t),m()}}()),s.appendChild(t)}};return function(u){0!==u&&(u||(u=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),e||(e=document.getElementById("globalSettings")),t||(t=document.getElementById("advancedSettings")),a||(a=document.getElementById("settingsSectionTabs")),n||(n=document.getElementById("addTab")),i||(i=document.getElementById("sectionSettings")),s||(s=document.getElementById("settingsPresetsList")),o||(o=document.getElementById("presetNameInput")),r||(r=document.getElementById("settingsPresetsOptOpen")),l||(l=document.getElementById("settingsPresetsOptSave")),c||(c=document.getElementById("downloader")),d||(d=document.getElementById("fileChooser")),0!==(u&refreshables.SETTINGS_BIT)&&E(),0!==(u&refreshables.TABS_BIT)&&m(),0!==(u&refreshables.PRESETLIST_BIT)&&S(),p||(n.addEventListener("click",function(){var e=new Section;settings.sections.push(e),w(settings.sections.length-1)}),d.addEventListener("change",function(e){for(var t=0;t<e.target.files.length-1;t++)loadFilePreset(e.target.files[t]);loadFilePreset(e.target.files[e.target.files.length-1],!0)}),r.addEventListener("click",function(){d.accept=".urm",d.click()}),l.addEventListener("click",function(){var e=o.value?o.value:"untitled";c.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),c.download=e+".urm",c.click();for(var t=0;void 0!==settingsPresets[e];)e=(o.value?o.value:"untitled")+" ("+t+")",t++;settingsPresets[e]=new Settings(settings),E(),m(),S()}),a.children.length>1&&y.call(a.children[0]),p=!0))}}();window.addEventListener("load",function(){function e(e){if(e.type.match("image.*")&&activeSection&&activeSection.type===sectionType.IMAGE){var t=new FileReader;t.addEventListener("load",function(e){activeSection.target.imageURL=e.target.result,refreshControls(refreshables.TABS_BIT)}),t.readAsDataURL(e)}}function t(e,t){q.src=t,currentSongTitle=e,document.title="Urmusic - "+e,q.play(),R.classList.add("masked")}function a(e){if(e.type.match("audio.*")){var a=new FileReader;a.addEventListener("load",function(a){t(e.name.substr(0,e.name.lastIndexOf(".")),a.target.result)}),a.readAsDataURL(e)}}function n(t){for(var n,i,s=0;s<t.length;s++)t[s].type.match("image.*")?n=t[s]:t[s].type.match("audio.*")?i=t[s]:t[s].name.endsWith(".urm")&&loadFilePreset(t[s],s===t.length-1);n&&e(n),i&&a(i)}function i(e,t,a){return t<0||t>=e.length?a:e[t]}function s(e,t,a,n){return(1-n)*(1-n)*e+2*(1-n)*n*t+n*n*a}function o(e,t,a,n){if(a){var o=Math.floor(t+.5);return s(lerp(i(e,o-1,n),i(e,o,n),.5),i(e,o,n),lerp(i(e,o,n),i(e,o+1,n),.5),t-o+.5)}var r=Math.floor(t),l=Math.ceil(t),c=i(e,r,n),d=i(e,l,n);return lerp(c,d,t-r)}function r(e,t){var a=t.minDecibels.value;return Math.max(o(b,lerp(t.freqStart.value,t.freqEnd.value,e)*b.length,t.quadratic,a)-a,0)/(t.maxDecibels.value-a)}function l(){if(w.smoothingTimeConstant=clamp(settings.smoothingTimeConstant.value,0,1),x.smoothingTimeConstant=clamp(settings.advanced.lowpassSmooth,0,1),P.smoothingTimeConstant=clamp(settings.advanced.highpassSmooth,0,1),!b&&(b=new Float32Array(w.frequencyBinCount),q.paused))for(var e=0;e<b.length;e++)b[e]=Number.MIN_SAFE_INTEGER;if(!E&&(E=new Float32Array(w.frequencyBinCount),q.paused))for(var e=0;e<E.length;e++)E[e]=0;if(settings.advanced.enableLowpass&&!L&&(L=new Float32Array(x.frequencyBinCount),q.paused))for(var e=0;e<L.length;e++)L[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!C&&(C=new Float32Array(P.frequencyBinCount),q.paused))for(var e=0;e<C.length;e++)C[e]=Number.MIN_SAFE_INTEGER;q.paused||(w.getFloatFrequencyData(b),w.getFloatTimeDomainData(E),settings.advanced.enableLowpass&&x.getFloatFrequencyData(L),settings.advanced.enableHighpass&&P.getFloatFrequencyData(C)),I.width==I.clientWidth&&I.height==I.clientHeight||(I.width=I.clientWidth,I.height=I.clientHeight),frameProps.minval=Math.min.apply(Math,b),frameProps.maxval=Math.max.apply(Math,b),frameProps.time=q.currentTime,frameProps.duration=q.duration,frameProps.prettytime=prettyTime(frameProps.time),frameProps.prettyduration=prettyTime(frameProps.duration),frameProps.imgw=0,frameProps.imgh=0,frameProps.imgr=0,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,L),frameProps.minlowval=Math.min.apply(Math,L)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,C),frameProps.minhighval=Math.min.apply(Math,C)),Q(),O(l)}function c(e,t,a){var n=(Math.pow(r(a,t),t.exponent.value)*t.height.value,lerp(t.startX.value,t.endX.value,a)),i=t.yPos.value,s=t.polar.value;if(s>0){var o=Math.cos((.5*n+.5)*Math.PI*2),l=Math.sin((.5*n+.5)*Math.PI*2),c=o*i,d=l*i;n=lerp(n*e,c*e,s),i=lerp(i*e,d*e,s)}else n*=e,i*=e;return{x:n,y:i}}function d(e,t,a){var n=lerp(t.startX,t.endX,a),i=t.yPos;if(t.polar>0){var s=Math.cos((.5*n+.5)*Math.PI*2),o=Math.sin((.5*n+.5)*Math.PI*2),r=s*i,l=o*i;n=lerp(n*e,r*e,t.polar),i=lerp(i*e,l*e,t.polar)}else n*=e,i*=e;return{x:n,y:i}}function p(e,t,a){var n=Math.pow(r(a,t),t.exponent.value)*t.height.value,i=lerp(t.startX.value,t.endX.value,a),s=t.yPos.value,o=s+t.minHeight.value+n,l=i,c=t.polar.value;if(c>0){var d=Math.cos((.5*i+.5)*Math.PI*2),p=Math.sin((.5*i+.5)*Math.PI*2),u=d*s,m=p*s,f=d*o,h=p*o;i=lerp(i*e,u*e,c),s=lerp(s*e,m*e,c),l=lerp(l*e,f*e,c),o=lerp(o*e,h*e,c)}else i*=e,s*=e,l*=e,o*=e;return{x:i,y:s,ex:l,ey:o}}function u(e,t,a){var n=o(E,a*E.length,t.quadratic,0),i=Math.abs(Math.pow(n,t.exponent.value));n=(n>=0?i:-i)*t.height.value;var s=lerp(t.startX.value,t.endX.value,a),r=t.yPos.value,l=r+n,c=s,d=t.polar.value;if(d>0){var p=Math.cos((.5*s+.5)*Math.PI*2),u=Math.sin((.5*s+.5)*Math.PI*2),m=p*r,f=u*r,h=p*l,g=u*l;s=lerp(s*e,m*e,d),r=lerp(r*e,f*e,d),c=lerp(c*e,h*e,d),l=lerp(l*e,g*e,d)}else s*=e,r*=e,c*=e,l*=e;return{x:s,y:r,ex:c,ey:l}}function m(){navigator.userAgent.indexOf("Firefox/")===-1&&(B.style.marginRight="0px")}function f(){SC.initialize({client_id:F});var e=document.getElementById("soundcloudApp").parentNode.getElementsByClassName("appLinkInput")[0],a=e.parentNode.parentNode;e.addEventListener("change",function(){a.classList.add("loading"),SC.resolve(this.value).then(function(e){var n=new XMLHttpRequest;n.onload=function(n){t(e.title+" (SoundCloud)",n.target.responseURL),a.classList.remove("loading")},n.open("GET",e.stream_url+"?client_id="+F),n.send()},function(){a.classList.remove("loading")})})}function h(e){var t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("input"),i=document.createElement("i");return t.classList.add("musicAppIconContainer"),t.appendChild(e),n.placeholder="Paste a link...",a.appendChild(n),a.appendChild(i),a.classList.add("appLinkForm"),n.classList.add("appLinkInput"),i.classList.add("loadIcon"),new Spinner(N).spin(i),t.appendChild(a),e.addEventListener("click",function(){t.classList.contains("activated")?t.classList.remove("activated"):t.classList.add("activated")}),t}function g(){for(var e=[];0!==D.children.length;)e.push(h(D.removeChild(D.children[0])));for(var t=0,a=e.length;t<a;t++)D.appendChild(e[t]);f()}var v,y,w,b,E,S,x,L,T,P,C,O=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},I=document.getElementById("cvs"),M=I.getContext("2d"),X=new AudioContext,F="09bfcfe5b0303000a41b9e9675c0cb47",N={lines:8,length:0,width:14,radius:19,scale:.3,corners:1,color:"#fff",opacity:0,rotate:90,direction:1,speed:1.5,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},q=document.getElementById("audioElement"),R=document.getElementById("helpNav"),U=document.getElementById("itsThePlayer"),B=document.getElementById("firefoxIsBetter"),A=B.getElementsByClassName("close")[0],D=document.getElementById("musicApps"),Y=document.getElementById("bottomMenuOpener"),_=document.getElementById("bottomMenu"),k=document.getElementById("videoRecord"),H=I.captureStream().getTracks()[0],W=X.createMediaStreamDestination().stream.getTracks()[0],G=new MediaRecorder(new MediaStream([H,W])),Z=document.getElementsByClassName("hidable"),Q=function(){function e(){l=r.dataCount.value;var e=r.mode;M.strokeStyle=o.color,M.fillStyle=o.color,M.lineWidth=r.lineWidth.value/100*i,M.shadowColor=o.color,M.shadowBlur=m*s,M.lineCap=r.lineCap.name.toLowerCase(),M.beginPath();for(var t=0;t<l&&(r.drawLast||t!==l-1);t++){var a=t/(l-1),n=p(i,r,a);(e==drawMode.LINES||0==t&&r.clampShapeToZero)&&M.moveTo(n.x,n.y),M.lineTo(n.ex,n.ey),t==l-1&&r.clampShapeToZero&&M.lineTo(n.x,n.y)}if(r.closeShape&&e!==drawMode.FILL&&M.closePath(),e===drawMode.FILL){if(r.smartFill)for(var t=l-1;t>=0;t--)if(r.drawLast||t!==l-1){var a=t/(l-1),d=c(i,r,a);M.lineTo(d.x,d.y)}M.fill()}else M.moveTo(0,0),M.stroke()}function t(){l=r.dataCount.value;var e=r.mode;M.strokeStyle=o.color,M.fillStyle=o.color,M.lineWidth=r.lineWidth.value/100*i,M.shadowColor=o.color,M.shadowBlur=m*s,M.lineCap=r.lineCap.name.toLowerCase(),M.lineJoin=r.lineJoin.name.toLowerCase(),M.beginPath();for(var t=0;t<l&&(r.drawLast||t!==l-1);t++){var a=t/(l-1),n=u(i,r,a);(e==drawMode.LINES||0==t&&r.clampShapeToZero)&&M.moveTo(n.x,n.y),M.lineTo(n.ex,n.ey),t==l-1&&r.clampShapeToZero&&M.lineTo(n.x,n.y)}if(r.closeShape&&e!==drawMode.FILL&&M.closePath(),e===drawMode.FILL){if(r.smartFill)for(var t=l-1;t>=0;t--)if(r.drawLast||t!==l-1){var a=t/(l-1),c=d(i,r,a);M.lineTo(c.x,c.y)}M.fill()}else M.moveTo(0,0),M.stroke()}function a(){M.strokeStyle=r.borderColor,M.fillStyle=o.color,M.lineWidth=r.borderSize.value/100*i,M.shadowColor=o.color,M.shadowBlur=m*s,M.scale(1,-1);var e=r.image,t=r.imageBorderRadius.value*i;0!==t?(M.roundRect(-i/2,-i/2,i,i,t),M.clip(),r.opaque&&M.fill(),r.borderVisible&&M.stroke(),r.imageReady&&M.drawImage(e,-i/2,-i/2,i,i)):(M.beginPath(),M.rect(-i/2,-i/2,i,i),r.opaque&&M.fill(),r.borderVisible&&M.stroke(),r.imageReady&&M.drawImage(e,-i/2,-i/2,i,i))}function n(){var e="";r.text&&""!==(e=r.text.value)&&(M.shadowColor=o.color,M.shadowBlur=m*s,M.fillStyle=o.color,M.font=r.fontStyle+" "+r.fontSize.value*i+"px "+r.fontFamily,M.textAlign=r.textAlign.name.toLowerCase(),M.textBaseline=r.textBaseline.name.toLowerCase(),M.scale(1,-1),M.fillText(e,0,0))}var i=0,s=0,o=null,r=null,l=32,m=0;return function(){aspect=I.width/I.height,i=Math.min(I.width,I.height),frameProps.csize=i,M.clearRect(0,0,I.width,I.height),M.fillStyle=settings.backgroundColor,M.fillRect(0,0,I.width,I.height),M.save(),M.translate(I.width/2,I.height/2),M.scale(.5,-.5),s=settings.globalScale.value,M.scale(s,s),M.translate(settings.globalOffsetX.value*i,settings.globalOffsetY.value*i),M.rotate(settings.globalRotation.value*Math.PI/180);for(var l=0;l<settings.sections.length;l++)o=settings.sections[l],r=o.target,o.visible&&(o.type===sectionType.IMAGE&&r.imageReady?(frameProps.imgw=r.image.width,frameProps.imgh=r.image.height,frameProps.imgr=frameProps.imgw/frameProps.imgh):frameProps.imgw=frameProps.imgh=frameProps.imgr=0,m=o.glowness.value,M.save(),M.translate(o.posX.value*i,o.posY.value*i),M.rotate(o.rotation.value*Math.PI/180),M.scale(o.scaleX.value,o.scaleY.value),M.globalAlpha=o.opacity.value,o.type===sectionType.FREQ?e():o.type===sectionType.TIME_DOM?t():o.type===sectionType.IMAGE?a():o.type===sectionType.TEXT&&n(),M.restore());M.restore()}}();if(window.addEventListener("keydown",function(e){if(!document.activeElement||"INPUT"!==document.activeElement.tagName)if(112===e.keyCode){e.preventDefault();for(var t=0;t<Z.length;t++)Z[t].classList.toggle("hidden")}else q.src&&(32===e.keyCode?(e.preventDefault(),q.paused?q.play():q.pause()):36===e.keyCode?q.currentTime=0:37===e.keyCode?q.currentTime-=5:39===e.keyCode&&(q.currentTime+=5))}),!I||!M||!X)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");v=X.createMediaElementSource(q),y=X.createGain(),y.gain.value=.8,w=X.createAnalyser(),w.fftSize=2048,S=X.createBiquadFilter(),S.type="lowpass",x=X.createAnalyser(),x.fftSize=2048,T=X.createBiquadFilter(),T.type="highpass",P=X.createAnalyser(),P.fftSize=2048,I.width=document.body.clientWidth,I.height=document.body.clientHeight,I.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),I.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n(e.dataTransfer.files)},!1),localStorage.urmusic_volume?y.gain.value=localStorage.urmusic_volume:localStorage.urmusic_volume=y.gain.value,THEPLAYER.setupPlayer(U,{target:q,volume:y.gain.value,onvolumechange:function(e){y.gain.value=e,localStorage.urmusic_volume=e}}),q.crossOrigin="anonymous";var z=document.getElementById("settingsNav"),J=document.getElementById("presetMenuOpenCloseBtn"),j=document.getElementById("settingsPresetsMenu"),V=document.getElementsByClassName("button");document.getElementById("hambParent").addEventListener("click",function(e){z.classList.contains("activated")?z.classList.remove("activated"):z.classList.add("activated"),z.classList.contains("activated")||(j.classList.remove("opened"),J.classList.remove("opened"))}),G.addEventListener("dataavailable",function(e){downloader.href=URL.createObjectURL(e.data),downloader.download="urmusic recording.webm",downloader.click(),k.innerHTML="Record a video",k.classList.remove("disabled")}),J.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),j.classList.remove("opened")):(this.classList.add("opened"),j.classList.add("opened"))}),A.addEventListener("click",function(){B.style.marginRight=""}),Y.addEventListener("click",function(){this.classList.toggle("closeMode"),U.classList.toggle("bottomMenuOpened"),_.classList.toggle("opened")}),k.addEventListener("click",function(){if(!this.classList.contains("disabled")){if("recording"===G.state)return void G.stop();q.currentTime=0,this.innerHTML="Stop the record"}});for(var K=0;K<V.length;K++){var $=V[K];$.addEventListener("mousedown",function(){this.classList.add("pushed")}),$.addEventListener("mouseup",function(){this.classList.remove("pushed")})}q.addEventListener("ended",function(){"recording"===G.state&&G.stop()}),q.addEventListener("pause",function(){"recording"===G.state&&G.pause()}),q.addEventListener("play",function(){"paused"===G.state&&G.resume()}),S.connect(x),T.connect(P),v.connect(y),v.connect(w),v.connect(S),v.connect(T),y.connect(X.destination),settings.advanced.watch("lowpassFreq",function(e,t,a){return S.frequency.value=a,a}),settings.advanced.watch("highpassFreq",function(e,t,a){return T.frequency.value=a,a}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,g(),console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.4.3\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),l();var ee=null;if(window.require&&(ee=window.require("electron"))){var te=ee.remote.process.argv;if(te[1]){var ae=te[1];ae=ae.replace(/\\/g,"/"),ae=ae.substr(ae.lastIndexOf("/")+1,ae.lastIndexOf(".")),t(ae,te[1])}}else m()});